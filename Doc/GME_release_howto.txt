HOWTO make a GME release (for GME maintainers only)
The following people make GME releases:
Zsolt Lattmann <lattmann@isis.vanderbilt.edu>
Peter Volgyesi <volgy@isis.vanderbilt.edu>
Daniel Balasubramanian <daniel@isis.vanderbilt.edu>

Previous maintainer/developer Kevin Smyth <kevin.m.smyth@gmail.com>


Prerequisites:
 - cygwin with ssh, scp, rsync, curl (marked as bash below), 7-zip, python2.7 (make sure python is in the PATH)
 - python markdown virtual environment (cmd)
 cd %USERPROFILE%\\Downloads
 python -m pip install virtualenv
 python -m virtualenv markdown
 markdown\Scripts\pip install markdown
 
 - ssh access
    - sudo to build@kms1.isis.vanderbilt.edu
    - repo@repo.isis.vanderbilt.edu

#(command line)
Update release notes: Doc/README_in.txt
Update version number: Doc/index.md
pushd Doc
%USERPROFILE%\Downloads\markdown\Scripts\python -m markdown index.md > index.html
popd
svn ci -m "GME release 16.3.23"

#wait for all gme builds on http://build.isis.vanderbilt.edu/

#Saving all symbols from the temporary symbol storage to the permanent symbol storage
#!/bin/bash
ID=$(curl -s -S http://build.isis.vanderbilt.edu/job/GME/label=build-slave9/lastBuild/consoleText | grep Finding\ ID | sed 's/.*Finding ID.....//; s/'$'\r'//)
ID_x64=$(curl -s -S http://build.isis.vanderbilt.edu/job/GME_x64/label=build-slave6/lastBuild/consoleText | grep Finding\ ID | sed 's/.*Finding ID.....//; s/'$'\r'//)
echo $ID $ID_x64
ssh build@kms1.isis.vanderbilt.edu 'cd symbolstmp && python ~/bin/pdb_promote.py '"$ID1 $ID2"
ssh build@kms1.isis.vanderbilt.edu rsync -avP symbols /media/7ce1528b-2101-4764-81e3-aed9112e3ad8/214/

#Downloading the build artifacts, i.e. two installers and the README file
mkdir GME-16.3.23
cd GME-16.3.23
export PATH=$PATH:/c/cygwin/bin:"/c/Program Files/7-Zip/:/cygdrive/c/Program Files/7-Zip/"
curl -o GME_x64-16.3.23.msi http://build.isis.vanderbilt.edu/job/GME_x64_msi/label=build-slave6/lastSuccessfulBuild/artifact/trunk/Install/GME_x64.msi && \
curl -o GME-16.3.23.msi http://build.isis.vanderbilt.edu/job/GME/label=build-slave9/lastSuccessfulBuild/artifact/trunk/Install/GME.msi && \
curl -o README.txt http://build.isis.vanderbilt.edu/job/GME/label=build-slave9/ws/trunk/Doc/README.txt

#!/bin/bash
for file in http://build.isis.vanderbilt.edu/job/GME_x64/lastSuccessfulBuild/label=build-slave6/artifact/trunk/Install/GME_bin_x64.wixlib http://build.isis.vanderbilt.edu/job/GME/lastSuccessfulBuild/label=build-slave9/artifact/trunk/Install/GME_bin.wixlib http://build.isis.vanderbilt.edu/job/GME/lastSuccessfulBuild/label=build-slave9/artifact/trunk/Install/GME_paradigms.wixlib http://build.isis.vanderbilt.edu/job/GME/lastSuccessfulBuild/label=build-slave9/artifact/trunk/Install/GME_SDK.wixlib; do curl -O $file; done

#!/bin/bash
svn cp -m 'Tag Release 16.3.23' https://svn.isis.vanderbilt.edu/GMESRC/trunk https://svn.isis.vanderbilt.edu/GMESRC/tags/Release_16.3.23
svn export https://svn.isis.vanderbilt.edu/GMESRC/tags/Release_16.3.23 GME-16.3.23_src && \
7z.exe a GME-16.3.23_src.zip GME-16.3.23_src/

#!/bin/bash
ssh repo@repo.isis.vanderbilt.edu mkdir GME/16.3.23/ && \
scp README.txt GME-16.3.23.msi GME_x64-16.3.23.msi GME-16.3.23_src.zip repo@repo.isis.vanderbilt.edu:GME/16.3.23/ && \
ssh repo@repo.isis.vanderbilt.edu chmod -R a+r GME/16.3.23/


# Update online documentation:
#!/bin/bash
cd GME-16.3.23_src/Doc
#ssh zsolt@kms1.isis.vanderbilt.edu sudo mount -t davfs -o uid=1006 https://forge.isis.vanderbilt.edu/gme/dav/ /home/build/gmedav
rsync --chmod=ugo+xr,u+w,o-w --perms --delete --delete-excluded -avP . --include=/Tutorial** --include google3a6cca9137b58176.html --include=index.html --include=markdown.css --include='*/' --include='**GME Manual and User Guide.pdf' --exclude=*  build@kms1.isis.vanderbilt.edu:/home/build/gmedav/www/


# Make sure links are working from http://repo.isis.vanderbilt.edu/GME/old/16.3.23/


## OPTIONAL STEPS
# JIRA: make release
# update https://svn.isis.vanderbilt.edu/isis-common/installs.py
#  c:\Python27\python.exe install_setup.py py2exe && move /y dist\install.exe .\install.exe


Install GME on VM, check for missing symbols
REM install these tools
REM   https://www.microsoft.com/en-us/download/details.aspx?id=8279 - Windows 7 debugging tools might be installed in "c:\Program Files\Debugging Tools for Windows (x64)\symchk.exe"
REM   7-zip http://www.7-zip.org/
set _NT_SYMBOL_PATH=srv*c:\GME_16.3.23_symbols*http://symbols.isis.vanderbilt.edu/;srv*c:\symbols*http://msdl.microsoft.com/download/symbols
mkdir c:\GME_16.3.23_symbols
"c:\Program Files (x86)\Debugging Tools for Windows (x86)\symchk.exe" /r "C:\Program Files (x86)\GME"
"c:\Program Files (x86)\Debugging Tools for Windows (x86)\symchk.exe" /r "C:\Program Files\GME"
"c:\Program Files\7-Zip\7z.exe" a -xr!.svn %userprofile%\GME_16.3.23_symbols.7z c:\GME_16.3.23_symbols
copy %userprofile%\GME_16.3.23_symbols.7z \\vboxsrv\xfer

scp Desktop/xfer/GME_16.3.23_symbols.7z repo@repo.isis.vanderbilt.edu:GME/16.3.23/ && \
ssh repo@repo.isis.vanderbilt.edu chmod -R a+r GME/16.3.23/


Method 2: extract files from msi
SetLocal EnableDelayedExpansion
cd %userprofile%\Downloads
set MSI=GME_x64-16.3.23.msi
set BASENAME=GME-16.3.23
set REPO_DIR=GME/16.3.23/
curl -sS -O http://repo.isis.vanderbilt.edu/%REPO_DIR%%MSI || exit /b !ERRORLEVEL!
set _NT_SYMBOL_PATH=srv*%userprofile%\Downloads\%BASENAME%_symbols*http://symbols.isis.vanderbilt.edu/
"C:\Program Files\7-Zip\7z.exe" x %MSI% -o%BASENAME% || exit /b !ERRORLEVEL!
del %BASENAME%\fil* %BASENAME%\F_CENTRAL*
"c:\Program Files (x86)\Debugging Tools for Windows (x86)\symchk.exe" /r "%userprofile%\Downloads\%BASENAME%"
pause Verify results and Press enter to continue
"C:\Program Files\7-Zip\7z.exe" a %BASENAME%_symbols.7z %BASENAME%_symbols || exit /b !ERRORLEVEL!
@rem "C:\Program Files\7-Zip\7z.exe" l %BASENAME%_symbols.7z

scp %BASENAME%_symbols.7z repo@repo.isis.vanderbilt.edu:%REPO_DIR%
ssh repo@repo.isis.vanderbilt.edu chmod -R a+r %REPO_DIR%
